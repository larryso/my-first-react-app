# Understanding Subscription, Service Principle and App Registry

## Azure subscription

An Azure subscription is a logical container in Microsoft Azure that is used to provision, manage, and pay for Azure resources and services. It acts as a billing and access control boundary, enabling organizations to organize and manage their cloud resources effectively. Here's a detailed explanation of Azure subscriptions:

1. Billing and Cost Management:

An Azure subscription is tied to a billing account, and all usage of Azure resources (e.g., virtual machines, storage, databases) within the subscription is billed to that account.

Subscriptions allow organizations to track costs and allocate budgets for specific projects, departments, or teams.

2. Access Control and Security:

Subscriptions are associated with an Azure Active Directory (Azure AD) tenant, which manages user identities and permissions.

Role-Based Access Control (RBAC) can be applied at the subscription level to control who can create, manage, or delete resources within the subscription.

3. Resource Management:

Resources (e.g., virtual machines, storage accounts, web apps) are created within a subscription.

Subscriptions can be organized into resource groups for better management and organization of related resources.

4. Scalability and Limits:

Azure subscriptions have certain limits and quotas (e.g., the number of virtual machines, storage accounts, or networks that can be created).

These limits can be increased by contacting Azure support.

5. Isolation and Segmentation:

Subscriptions provide a way to isolate resources for different environments (e.g., development, testing, production) or departments (e.g., finance, marketing).

This helps in maintaining security, compliance, and cost tracking.

### Types of Azure Subscriptions

1. Free Account Subscription:

Offers limited access to Azure services for free for 12 months, along with a credit to explore paid services.

Ideal for learning and experimenting with Azure.

2. Pay-As-You-Go Subscription:

Charges based on actual usage of Azure resources.

Suitable for businesses and individuals who want flexibility without long-term commitments.

3. Enterprise Agreement (EA) Subscription:

Designed for large organizations with negotiated pricing and billing based on annual commitments.

Provides additional benefits like cost management tools and discounts.

4. Visual Studio Subscription:

Offers Azure credits as part of Visual Studio benefits for developers.

Ideal for development and testing purposes.

5. Azure CSP (Cloud Solution Provider) Subscription:

Sold through Microsoft partners, who manage billing and support for customers.

Suitable for small and medium-sized businesses.

6. Azure Government Subscription:

A specialized subscription for U.S. government agencies and partners, offering compliance with government regulations.

7. Azure for Students Subscription:

Provides free Azure credits to students for learning and building projects.

## Service Principal

A Service Principal is an identity created for use with applications, services, and automation tools to access specific Azure resources. It is essentially a security identity used by applications or services to authenticate and interact with Azure resources. Here’s a breakdown of its key aspects:

1. Authentication: Service Principals are used to authenticate applications or services that need to access Azure resources. They can be authenticated using a client secret, certificate, or federated identity (e.g., via Azure AD).

2. Authorization: Once authenticated, the Service Principal is granted specific permissions (via roles) to access Azure resources. These permissions are defined by Azure Role-Based Access Control (RBAC).

3. Use Cases:

* Automating tasks using scripts or tools (e.g., Terraform, PowerShell, or Azure CLI).

* Allowing third-party applications to access Azure resources securely.

* Running background services or daemons that interact with Azure.

4. Creation: A Service Principal is created in Azure Active Directory (Azure AD) and is associated with an Azure subscription or resource.

5. Components:

* Application ID: A unique identifier for the application or service.

* Tenant ID: The Azure AD tenant where the Service Principal is registered.

* Client Secret/Certificate: Credentials used for authentication.

## App Registration

App Registration is the process of registering an application in Azure Active Directory (Azure AD) to enable authentication and authorization for that application. When you register an app, Azure AD creates a unique identity for it, which can then be used to authenticate and interact with Azure resources or other services.

Here’s how App Registration works:

1. Purpose: App Registration is used to integrate applications with Azure AD, enabling features like single sign-on (SSO), OAuth 2.0, and OpenID Connect for authentication.

Key Components:

* Application (Client) ID: A unique identifier for the application.

* Directory (Tenant) ID: The Azure AD tenant where the app is registered.

* Authentication Endpoints: URLs for OAuth 2.0 and OpenID Connect authentication.

* Redirect URIs: URLs where Azure AD can send responses after authentication.

* Certificates & Secrets: Credentials used by the app to authenticate itself.

### Relationship with Service Principal:

When you register an app in Azure AD, a corresponding Service Principal is automatically created in the same tenant. This Service Principal represents the app’s identity and is used to assign permissions to Azure resources.

## How to create a service principle in Azure

### 1. Using Azure CLI

Steps:

1. Install Azure CLI (if not already installed):

Download and install the Azure CLI from [here](https://docs.microsoft.com/en-us/cli/azure/install-azure-cli).

2. Log in to Azure:

`az login`

3. Create the Service Principal:

`az ad sp create-for-rbac --name "MyServicePrincipalName"`

4. Output:

{
  "appId": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
  "displayName": "MyServicePrincipalName",
  "password": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
  "tenant": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
}

5. Assign Roles

By default, the service principal has no permissions. Assign a role to grant access to Azure resources:

`az role assignment create --assignee <appId> --role <roleName> --scope <resourceScope>`

Replace <appId> with the appId from the output.

Replace <roleName> with the desired role (e.g., Contributor, Reader).

Replace <resourceScope> with the scope of the resource (e.g., /subscriptions/<subscriptionId>/resourceGroups/<resourceGroupName>).

### 2. Using Azure Portal

Steps:

1. Navigate to Azure Active Directory:

   Go to the Azure portal.

   Select Azure Active Directory > App registrations.

2. Create a New App Registration:

   Click New registration.

   Provide a name for your application.

   Choose the supported account type (e.g., single tenant or multi-tenant).

   Click Register.

3. Create a Client Secret:

   After registration, go to the Certificates & secrets section.

   Click New client secret and provide a description and expiration date.

   Save the client secret (you won’t be able to retrieve it later).

4. Assign Roles:

   Go to the Azure resource (e.g., a resource group or subscription) where you want to grant access.

   Select Access control (IAM) > Add role assignment.

   Choose the role (e.g., Contributor) and assign it to the service principal (search by the app name).

### Authenticating with a Service Principal

Once the service principal is created, you can use it to authenticate and interact with Azure resources. For example:

`az login --service-principal -u <appId> -p <password> --tenant <tenantId>`
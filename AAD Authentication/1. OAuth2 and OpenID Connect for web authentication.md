# OAuth2 and OpenID Connect for web authorization
When you are developing a web applicaiton that needs to authenticate and authorize users, you have two standards - OAuth2 and OpenID Connect.

OAuth2 is a framework that allows a third-party application (called a client) to access resources from a resource server(such as an API) on hehalf of a user (called a resource owner), the user grants the client a limited access token, which the client can use to request resources from the resource server. the access token is issued by an authorization server, which verifies the identity and consent of the user.

OpenID connect is an extension of OAuth2 that adds an identity layer to the authorization framework, it allows a client to verify the identity of the user and obtain basic profile information, the user logs in to an identity provider (like Google or Facebook) using openID Connect, and the identity provider returns an ID Token to the client, the ID Token is a json web token (JWT) that contains infromation about the user, the client can also request an access token and refresh token from the identity provider, which can be used to access other resources.

## An Introduction to OAuth 2
OAuth defines four roles:
* <b>Client: </b>The client is the application that wants to access the user’s account
* <b>Resource Server: </b>The resource server hosts the protected user accounts.
* <b>Resource Owner: </b>The resource owner is the user who authorizes an application to access their account. The application’s access to the user’s account is limited to the scope of the authorization granted (e.g. read or write access)
* <b>Authorization Server: </b>The authorization server verifies the identity of the user then issues access tokens to the application.

Abstract Protocol Flow:

![](../imgs/abstract_flow.png)

Here is a more detailed explanation of the steps in the diagram:

1. The application requests authorization to access service resources from the user
2. If the user authorized the request, the application receives an authorization grant
3. The application requests an access token from the authorization server (API) by presenting authentication of its own identity, and the authorization grant
4. If the application identity is authenticated and the authorization grant is valid, the authorization server (API) issues an access token to the application. Authorization is complete.
5. The application requests the resource from the resource server (API) and presents the access token for authentication
6. If the access token is valid, the resource server (API) serves the resource to the application

### Application Registration
Before using OAuth with your application, you must register your application and provide the following information:
* Application Name
* Application Website
* Redirect URI or Callback URL
The redirect URI is where the service will redirect the user after they authorize (or deny) your application, and therefore the part of your application that will handle authorization codes or access tokens.
### Client ID and Client Secret
Once your application is registered, the service will issue client credentials in the form of a client identifier and a client secret.
### Authorization Grant
In the Abstract Protocol Flow outlined previously, the first four steps cover obtaining an authorization grant and access token. The authorization grant type depends on the method used by the application to request authorization.
OAuth 2 defines three primary grant types, each of which is useful in different cases:

* Authorization Code: used with server-side Applications
* Client Credentials: used with Applications that have API access
* Device Code: used for devices that lack browsers or have input limitations
#### Grant Type: Authorization Code
#### Grant Type: Client Credentials
#### Grant Type: Device Code

## OpenID Connect (OIDC)

### Key components of OIDC
There are six primary components in OIDC:

* <b>Authentication</b> is the process of verifying that the user is who they say they are.

* A <b>client</b> is the software, such as website or application, that requests tokens that are used to authenticate a user or access a resource.

* <b>Relying parties</b> are the applications that use OpenID providers to authenticate users.  

* <b>Identity tokens</b> contain identity data including the outcome of the authentication process, an identifier for the user, and information about how and when the user is authenticated. 

* <b>OpenID providers</b> are the applications for which a user already has an account. Their role in OIDC is to authenticate the user and pass that information on to the relying party.

* <b>Users</b> are people or services that seek to access an application without creating a new account or providing a username and password. 

### How does OIDC authentication work?
#### ID tokens 
The OpenID provider uses ID tokens to transmit authentication results and any pertinent information to the relying party. Examples of the type of data that are sent include an ID, email address, and name.

#### Scopes
Scopes define what the user can do with their access. OIDC provides standard scopes, which define things such as which relying party the token was generated for, when the token was generated, when the token will expire, and the encryption strength used to authenticate the user. 

#### A typical OIDC authentication process includes the following steps:

1. A user goes to the application they wish to access (the relying party).
2. The user types in their username and password.
3. The relying party sends a request to the OpenID provider.
4. The OpenID provider validates the user’s credentials and obtains authorization.
5. The OpenID provider sends an identity token and often an access token to the relying party.
6. The relying party sends the access token to the user’s device.
7. The user is given access based on the information provided in the access token and relying party. 

### What are OIDC flows?
OIDC flows define how tokens are requested and delivered to the relying party. A few examples:

* <b>OIDC authorization flows</b>: The OpenID provider sends a unique code to the relying party. The relying party then sends the unique code back to the OpenID provider in exchange for the token. This method is used so that the OpenID provider can verify the relying party before sending the token. The browser can’t see the token in this method, which helps keep it secure.

* <b>OIDC authorization flows with PKCE extension</b>: This flow is the same as the OIDC authorization flow, except that it uses a public key for code exchange (PKCE) extension to send communications as a hash. This reduces the chances that the token will be intercepted.

* <b>Client credentials</b>: This flow provides access to web APIs by using the identity of the application itself. It’s typically used for server-to-server communication and automated scripts requiring no user interaction.

* <b>Device code</b>: This flow allows users to sign in and access web-based APIs on internet-connected devices that do not have browsers or have a poor keyboard experience, such as a smart TV. 

Additional flows, such as the OIDC implicit flow, which is designed for browser-based applications, are not recommended because they are a security risk.